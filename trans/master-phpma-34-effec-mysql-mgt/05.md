# 第五章数据和结构的变更

数据不是静态的，它经常变化。本章重点介绍编辑和删除数据及其支持结构表和数据库。

本章分为两个主要部分。第一部分涵盖更改数据的所有方面。首先，我们研究如何编辑数据，即如何进入编辑模式，如何一次编辑多行，以及如何从内联编辑中获益。接下来，我们将了解如何删除数据行以及如何删除表和数据库。

第二部分介绍如何修改表的结构。我们研究如何向表中添加列；然后，我们探索各种列类型，例如 `TEXT, BLOB, ENUM, DATE`和 `BIT`列类型。最后，我们检查了索引的管理。

# 变更数据

在本节中，我们将介绍编辑和删除数据的各种方法。

## 进入编辑模式

当我们浏览表格或查看任何单个表格查询的搜索结果时，每个表格行的左侧或右侧都会出现小图标和链接，如以下屏幕截图所示：

![Entering edit mode](graphics/7782_05_01.jpg)

该行可以使用其中一个铅笔形图标**（编辑）**进行编辑，也可以使用红色图标**（删除）**进行删除。这些控制措施的确切形式和位置受以下条款管辖：

```
$cfg['PropertiesIconic'] = 'both';
$cfg['ModifyDeleteAtLeft'] = true;
$cfg['ModifyDeleteAtRight'] = false;

```

我们可以决定是在左侧、右侧还是两侧显示它们。 `$cfg['PropertiesIconic']`参数可以将值 `TRUE, FALSE`或 `both. TRUE`仅显示图标， `FALSE`显示**编辑、内联编辑、复制**和**删除**（或其翻译等效项）作为链接， `both`显示图标和文本，如前一屏幕截图所示。

每行旁边的小复选框在本章后面的*多行编辑*和*删除多行*部分中进行了说明。

点击**编辑**图标或链接，出现如下面板，与数据输入面板类似（下部除外）：

![Entering edit mode](graphics/7782_05_02.jpg)

在这个面板中，我们可以通过直接键入（或通过正常操作系统机制剪切和粘贴）来更改数据。我们也可以使用**重置**按钮恢复到原始内容。

默认情况下，下方下拉菜单设置为**保存**（以便我们对此行进行更改）和**返回上一页**（以便我们可以继续编辑上一结果页上的另一行）。单击**Go**后，我们可能希望停留在当前页面上-为了保存并继续编辑，我们可以选择**Go back to this page**。如果要在保存当前行后再插入一行，只需在保存前选择**插入另一行**。本章后面的*复制数据行*一节将解释**插入为新行**选项（在**保存**选项下方）。

### 使用 tab 键移动到下一个字段

喜欢使用键盘的人可以使用*Tab*键进入下一个字段。通常，光标从左到右，从上到下移动，因此它将进入**函数**列中的字段（稍后将对此进行详细介绍）。但是，为了简化 phpMyAdmin 中的数据导航，已更改了正常的导航顺序。*Tab*键首先通过**值**列中的每个字段，然后通过**功能**列中的每个字段。

### 箭在弦上

另一种在字段之间移动的方式是使用*Ctrl*+*箭头*键。当屏幕上有许多字段时，此方法可能比使用*选项卡*键更简单。要使其工作， `$cfg['CtrlArrowsMoving']`参数必须设置为 `true`，这是默认值。

### 注

在某些情况下，此技术不能用于在字段之间移动。例如，Google Chrome 浏览器不支持*Ctrl*+*箭头*。此外，在启用空格的 Mac OS X 10.5 上，*Ctrl*+*箭头*是在虚拟桌面之间切换的默认快捷方式。

### 处理空值

如果表的结构允许列中有一个 `NULL`值，则该列的**Null**列中会出现一个小复选框。选择此选项会在列中输入一个 `NULL`值。每当将数据输入该列的**值**时，**空**复选框将自动清除。（这在支持 JavaScript 的浏览器中是可能的。）

在下面的屏幕截图中，我们修改了 `author`表中**phone**列的结构，允许使用 `NULL`值（参见本章*编辑列属性*部分）。此处未选中**空**复选框：

![Handling NULL values](graphics/7782_05_03.jpg)

选择**空**框后，删除相应数据。

### 将函数应用于值

MySQL 语言提供了一些函数，我们可以在保存数据之前应用这些函数。如果 `$cfg['ShowFunctionFields']`设置为 `TRUE`，则其中一些功能会出现在每列旁边的下拉菜单中。

函数列表在 `$cfg['Functions']`数组中定义。通常，这些数组的默认值位于 `libraries/config.default.php`中。我们可以通过将需要的部分复制到 `config.inc.php`中来更改它们。如果我们这样做，因为这些值可能会随着版本的变化而变化，我们应该注意将我们的变化与新版本的值合并。列表中首先显示特定数据类型最常用的函数。在 `$cfg['RestrictColumnTypes']`和 `$cfg['RestrictFunctions']`数组中定义了一些限制。

如下图所示，保存此行时，我们可以将**UPPER**函数应用于**title**列，将标题转换为大写字符：

![Applying a function to a value](graphics/7782_05_04.jpg)

为了获得一些屏幕空间，可以通过将 `$cfg['ShowFunctionFields']`设置为 `FALSE`来禁用此功能。此外，**功能**列标题是可点击的，因此我们可以动态禁用此功能。

当通过单击或通过配置参数禁用该功能时，会出现一个**显示：功能**链接，以便通过单击显示该**功能**列，如以下屏幕截图所示：

![Applying a function to a value](graphics/7782_05_05.jpg)

通过点击**类型**列标题或通过配置 `$cfg['ShowFieldTypesInDataEditView']`，可以为**类型**列标题提供类似功能。

### 复制数据行

在数据维护过程中（出于永久复制或测试目的），我们通常需要生成一行的副本。如果在同一个表中执行此操作，则必须遵守密钥唯一性规则。

下面是一个行复制的示例。我们的作者写了他那本关于电影的书的第二卷。因此，需要稍微更改的列是 ISBN、标题和页数。我们将现有行带到屏幕上，更改这三列，选择**插入为新行**，如下图所示：

![Duplicating rows of data](graphics/7782_05_06.jpg)

当我们点击**Go**时，会用修改后的信息创建另一行，保持原始行不变，如下图：

![Duplicating rows of data](graphics/7782_05_07.jpg)

存在快捷链接以实现相同的操作。在浏览表格时，点击特定行的**复制**按钮，将显示该行的编辑面板，并选择**插入为新行**而不是**保存**。

## 多行编辑

多行编辑功能使我们能够在要编辑的行上使用复选框，并使用**中的**更改**链接（或铅笔状图标）和选中的**菜单。**全部选中/全部取消选中**链接也可用于快速选中或取消选中所有框。我们还可以单击行数据上的任意位置以激活相应的复选框。要选择一个复选框范围，我们可以单击该范围的第一个复选框，然后*Shift*+单击该范围的最后一个复选框。

![Multi-row editing](graphics/7782_05_08.jpg)

单击**更改**后，将出现一个包含所有选定行的编辑面板。在查看、比较和更改这些行中的数据时，编辑过程可能会继续。当我们用复选框标记一些行时，我们还可以对它们执行另外两个操作：**删除**（请参阅本章*删除多行*部分）和**导出**（请参阅[第 6 章](06.html "Chapter 6. Exporting Structure and Data (Backup)")。

## 编辑下一行

对于主键位于整数列上的表，可以进行顺序编辑。我们的 `author`表符合标准。让我们看看当我们开始编辑具有**id**值**1:**的行时会发生什么

![Editing the next row](graphics/7782_05_09.jpg)

编辑面板出现，我们可以编辑作者编号**1**。但是，在下拉菜单中，**编辑下一行**选项可用。如果选中，下一个作者（主键值大于当前主键值的第一个作者）将可用于编辑。

## 行内编辑

版本 3.4 引入了内联行编辑，即在编辑时查看结果集的其他行。如果通过 `config.inc.php`或用户偏好将 `$cfg['AjaxEnable']`设置为 `true`，则此功能可用。点击**内联编辑**显示以下对话框：

![Inline row editing](graphics/7782_05_10.jpg)

编辑完需要修改的栏目后，点击**保存**。使用**隐藏**链接也可以中止更改。

## 删除数据

phpMyAdmin 的界面允许我们删除以下数据：

*   单行数据
*   表的多行
*   表中的所有行
*   多个表中的所有行

### 删除单行

我们可以使用每行旁边的红色**删除**图标删除该行。如果 `$cfg['Confirm']`的值设置为 `TRUE`，则每个 MySQL `DELETE`语句在执行前都需要确认。这是默认设置，因为只需单击一次就可以删除一行可能不明智！

确认的形式取决于浏览器执行 JavaScript 的能力。基于 JavaScript 的确认弹出窗口类似于以下屏幕截图：

![Deleting a single row](graphics/7782_05_11.jpg)

如果浏览器中禁用了 JavaScript，则会出现一个不同的面板。

实际的 `DELETE`语句将使用所需的任何信息来确保只删除预期的行。在我们的例子中， `WHERE`子句中定义并使用了主键。如果没有主键，将根据每列的值生成一个较长的 `WHERE`子句。生成的 `WHERE`子句甚至可能会阻止 `DELETE`操作的正确执行，尤其是在存在 `TEXT`或 `BLOB`列类型的情况下。这是因为用于将查询发送到 web 服务器的 HTTP 事务的长度可能受到浏览器或服务器的限制。这是强烈建议定义主键的另一个原因。

### 删除多行

假设我们检查了一页行，并决定必须销毁某些行。不是使用**删除**链接或图标逐个删除它们，因为有时必须在检查一组行时做出删除决定， `Table`视图模式下的行旁边有复选框，如以下屏幕截图所示：

![Deleting multiple rows](graphics/7782_05_12.jpg)

这些选项与选择了菜单的**中的**删除**图标一起使用。此时会出现一个确认屏幕，列出将要删除的所有行。**

### 删除表中的所有行

为了完全删除表中的所有行（保留其结构不变），我们首先从导航面板中选择相关数据库来显示数据库**结构**页面。然后我们使用与要清空的表位于同一行的**清空**图标或链接，如下所示：

![Deleting all of the rows in a table](graphics/7782_05_13.jpg)

我们收到一条确认 `TRUNCATE`语句（用于快速清空表的 MySQL 语句）的消息。对于我们的练习，我们不会删除这些宝贵的数据！

### 注

逐行或清空表来删除数据是一项永久性操作。只有通过恢复备份，才能进行恢复。

### 删除多个表中的所有行

每个表名的左侧都有一个复选框。我们可以选择一些桌子。然后，在选择了菜单的**中，选择**清空**操作，如下图截图所示：**

![Deleting all rows in multiple tables](graphics/7782_05_14.jpg)

当然，这一决定决不能掉以轻心！

## 删除表

删除表会删除数据和表的结构。在 `Database`视图中，我们可以使用该表的红色**下拉**图标删除该表。删除多个表也存在相同的机制（使用下拉菜单和**drop**操作）。

## 删除数据库

我们可以通过进入 `Server`视图中的**数据库**页面，选中不需要的数据库旁边的复选框，点击**下拉**链接，删除整个数据库（包括其所有表）

![Deleting databases](graphics/7782_05_15.jpg)

默认情况下， `$cfg['AllowUserDropDatabase']`设置为 `FALSE`。因此，在手动将此设置更改为 `TRUE`之前，此面板不允许非特权用户删除数据库。

为了帮助我们三思而后行，您**将要销毁一个完整的数据库-删除数据库前出现**。

### 注

包含所有用户和权限定义的数据库 `mysql`非常重要。因此，此数据库的复选框被停用，即使是管理员也不可用。

# 改变工作台结构

在开发应用程序时，有关数据结构的需求经常会因为新的或修改的需求而发生变化。开发人员必须通过明智的表结构编辑来适应这些更改。本节探讨更改表结构的主题。具体来说，它展示了如何将列添加到现有表中并编辑列的属性。然后，我们基于这些概念引入更专门的列类型，并通过 phpMyAdmin 解释它们的处理。最后，我们将讨论索引管理的主题。

## 增加一列

假设我们需要一个新列来存储一本书的语言，默认情况下，我们保存数据的书是用英语写的。我们称**列为**，其中包含由两个字符组成的代码**（默认为 en**。

在 `book`表的 `Table`视图的**结构**页面中，我们可以找到**添加列**对话框。在这里，我们指定需要多少新列，以及它们将放在哪里。

表中新列的位置仅从开发人员的角度起作用。我们通常对列进行逻辑分组，以便在列列表中更容易找到它们。列的确切位置在预期结果（查询的输出）中不会起作用，因为不管表结构如何，都可以调整这些结果。通常，最重要的列（包括键）位于表的开头。然而，这是个人偏好的问题。

我们想把新的列**放在表**的末尾。因此，我们选中相应的单选按钮并点击**Go**。

![Adding a column](graphics/7782_05_16.jpg)

其他可能的选择是表开头的**和**后面的**（我们必须从下拉菜单中选择，新的一列必须在该列之后）。**

我们看到了熟悉的用于输入列属性的面板。我们填写它。但是，由于我们希望这次输入默认值，因此我们执行以下两个操作：

*   将**默认**下拉菜单从**无**更改为**定义的**
*   输入默认值：**en**

然后点击**保存**。

![Adding a column](graphics/7782_05_17.jpg)

### 垂直模式

上一个面板显示为垂直模式，因为 `$cfg['DefaultPropDisplay']`的默认值为 `3`。这意味着对于三列或更少的列，将使用垂直模式，对于三列以上的列，将自动选择水平模式。在这里，我们可以使用我们选择的一些方法。

如果我们将 `$cfg['DefaultPropDisplay']`设置为`'vertical'`，添加新列的面板（以及编辑列结构的面板）将始终以垂直顺序显示。该参数也可以取`'horizontal'`值来强制水平模式。

## 编辑栏目属性

在**结构**页面上，我们可以对我们的表进行进一步修改：

![Editing column attribute](graphics/7782_05_18.jpg)

此面板不允许对列进行所有可能的更改。它特别允许：

*   更改一个柱结构，在特定柱上使用**更改**链接
*   使用**下降**操作移除一个柱
*   向现有的**主**键添加列
*   在列上设置非唯一的**索引**或**唯一的**索引
*   设置**全文**索引（仅列类型允许时提供）

这些是在某些情况下可能有用的快速链接，但它们不能取代完整的索引管理面板。本章将对这两个方面进行解释。

我们可以使用复选框选择列。然后，通过选择的图标，使用适当的**，我们可以使用**更改**编辑列，或者使用**删除**进行多列删除。**全部选中/全部取消选中**选项允许我们轻松选中或取消选中所有框。**

## 文本列类型

现在，我们将探讨如何使用**文本**列类型和相关配置值来调整 phpMyAdmin 的最佳行为。首先，我们在**书**表中增加了一个名为**说明**的**文本**列。

有三个配置指令控制将在**文本**列类型的**插入**或**编辑**模式下显示的文本区域的布局。每列的显示列数和行数由以下公式定义：

```
$cfg['TextareaCols'] = 40;
$cfg['TextareaRows'] = 15;

```

这（默认情况下）为处理**文本**列类型提供了空间，如以下屏幕截图所示：

![TEXT column type](graphics/7782_05_19.jpg)

这些设置仅对文本区域施加视觉限制，必要时浏览器会创建一个垂直滚动条。

### 注

尽管**MEDIUMTEXT、TEXT**和**LONGTEXT**列类型可以容纳超过 32kib 的数据，但一些浏览器无法始终使用 HTML 提供的文本区域机制对其进行编辑。事实上，实验已经说服 phpMyAdmin 开发团队，如果内容大于 32kib，产品将显示一条警告消息。该消息警告用户内容可能不可编辑。

最后一个配置指令 `$cfg['LongtextDoubleTextarea']`仅对**LONGTEXT**列类型有影响。 `TRUE`的默认值是可用编辑空间的两倍。

## BLOB（二进制大对象）列类型

**BLOB**列类型通常用于保存二进制数据（如图像和声音），尽管 MySQL 文档暗示**文本**列类型可用于此目的。MySQL 5.1 手册说：“在某些情况下，可能需要将二进制数据（如媒体文件）存储在 BLOB 或文本列中”。然而，另一个短语：“BLOB 列被视为二进制字符串（字节字符串）”，似乎表示二进制数据应该真正存储在**BLOB**列中。因此，phpMyAdmin 的意图是使用**BLOB**列类型来保存所有二进制数据。

我们将在[第 16 章](16.html "Chapter 16. Transforming Data using MIME")中看到，对于**BLOB**列类型，有一些特殊的机制可以进一步使用，包括可以直接从 phpMyAdmin 中查看一些图像。

首先，我们在 `book`表中添加了一个名为**封面照片**的**BLOB**列类型。如果我们现在浏览表格，我们可以看到每个**BLOB**列类型的长度信息**【BLOB-0B】**。

![BLOB (Binary Large Object) column type](graphics/7782_05_20.jpg)

这是因为**显示 BLOB**显示选项（您还记得**选项**滑块吗？）默认没有复选标记。因此，它在浏览模式下阻止了**BLOB**内容的显示。这种行为是故意的。通常，我们不能用纯文本表示的二进制数据做任何事情。

### 上传二进制内容

如果我们编辑一行，我们会看到**二进制不编辑**警告和**浏览……**按钮。此按钮上的确切标题取决于浏览器。即使不允许编辑，我们也可以轻松地将文本或二进制文件的内容上传到此**blob**列。

让我们使用**浏览**按钮选择一个图像文件，例如，位于客户端工作站上的 `phpMyAdmin/themes/pmahomme/img`目录的测试副本中的 `logo_left.png`文件。我们现在点击**Go**。

![Uploading binary content](graphics/7782_05_21.jpg)

我们需要记住上传大小的一些限制。首先，**blob**列大小限制为 64KIB，但在[第 16 章](16.html "Chapter 16. Transforming Data using MIME")中，我们将更改此列的类型以适应更大的图像。因此，phpMyAdmin 以**Max:64KiB**警告提醒我们这个限制。此外，PHP 本身可能存在固有的限制（有关更多详细信息，请参阅[第 7 章](07.html "Chapter 7. Importing Structure and Data")。现在，我们在该列中上载了一个特定行的图像。

![Uploading binary content](graphics/7782_05_22.jpg)

我们注意到**BLOB-4.9KiB**是一个链接；它允许在需要时将任何二进制数据下载到我们的工作站。

如果我们为**显示 BLOB 内容**显示选项打上复选标记，我们现在可以在**BLOB**列类型中看到以下内容：

![Uploading binary content](graphics/7782_05_23.jpg)

### 注

要从 phpMyAdmin 中真正查看图像，请参阅[第 16 章](16.html "Chapter 16. Transforming Data using MIME")。

`$cfg['ProtectBinary']`参数控制编辑二进制列**（BLOB**和具有 `binary`属性的任何其他列）时可以执行的操作。默认值**blob**阻止**blob**列被编辑，但允许我们编辑 MySQL 标记为 `binary`的其他列。 `all`的值将阻止对 `binary`列进行编辑。 `FALSE`的值不会保护任何内容，因此允许我们编辑所有列。如果我们尝试最后一个选项，我们将在此行的**编辑**面板中看到以下内容：

![Uploading binary content](graphics/7782_05_24.jpg)

此 `BLOB`列类型的内容已转换为十六进制，默认选择**UNHEX**函数。我们可能不希望以十六进制编辑此图像数据，但这是在屏幕上安全表示二进制数据的最佳方式。之所以使用十六进制表示法，是因为当前标记了**将二进制内容显示为十六进制显示**选项（在**浏览**模式下）。但我们没有标记这个选项；由于 `$cfg['DisplayBinaryAsHex']`指令默认为 `TRUE`而被选中。

如果我们决定不标记此选项，我们将看到此图像的以下纯二进制数据：

![Uploading binary content](graphics/7782_05_25.jpg)

有可能这不是我们最喜欢的图像编辑器！事实上，即使我们保存这一行而不接触**BLOB**列类型，数据也可能被破坏。但是存在将 `$cfg['ProtectBinary']`设置为 `FALSE`的可能性，因为一些用户在**BLOB**列中放入文本，并且他们需要能够修改此文本。这就是为什么可以将 phpMyAdmin 配置为允许编辑**BLOB**列的原因。

MySQL**BLOB**数据类型实际上与对应的**文本**数据类型相似。但是，我们应该记住，**BLOB**没有字符集，而**文本**列类型有影响排序和比较的字符集。

## 枚举并设置列类型

枚举和集合列类型都用于表示可能值的列表。不同之处在于，用户只能从定义的**枚举**的值列表中选择一个值，而**设置为**的值可以选择多个值。当**设置为**时，所有多个值进入一个单元格；但多个值并不意味着创建多行数据。

我们在 `book`表中添加了一个名为**流派**的列，并将其定义为**枚举**。现在，我们选择将短代码放入值列表中，并将其中一个**F**设置为默认值，如以下屏幕截图所示：

![ENUM and SET column types](graphics/7782_05_26.jpg)

在值列表中，我们必须将每个值用单引号括起来，这与默认值字段不同。从 3.4.0 版开始，可以使用针对 `ENUM/SET`列的编辑器。有了这个编辑器，我们不需要费心在单引号中括起值。点击**获取更多编辑空间**将此编辑器带入行动：

![ENUM and SET column types](graphics/7782_05_27.jpg)

在我们的设计中，这些值代表**幻想、儿童**和**小说**。但是，目前，我们希望通过短代码查看接口的行为。在**插入**面板中，我们现在看到一个收音机盒界面，如下图所示：

![ENUM and SET column types](graphics/7782_05_28.jpg)

如果我们决定有更多的自我描述值，我们可以回到**结构**模式，并更改**类型**列的值定义。我们还必须将默认值更改为可能的值之一，以避免在尝试保存此列结构的修改时收到错误消息。

![ENUM and SET column types](graphics/7782_05_29.jpg)

通过修改值列表，**插入**面板现在如下所示：

![ENUM and SET column types](graphics/7782_05_30.jpg)

请注意，由于可能值的长度较大，单选按钮已被下拉列表替换。

如果我们想要选择多个可能的值，我们必须将列类型更改为**设置**。可以使用相同的值列表。但是，使用浏览器的多值选择器（在 Windows 或 Linux 桌面上单击 control，在 Mac 上单击 command），我们可以选择多个值，如屏幕截图所示：

![ENUM and SET column types](graphics/7782_05_31.jpg)

### 注

在规范化的数据结构中，我们将只在 `book`表中存储**类型**代码，并依赖另一个表来存储每个代码的描述。在这种情况下，我们不会使用**集合**或**枚举**。

## 日期、日期时间和时间戳列类型

我们可以使用普通字符列来存储日期或时间信息。但是**日期、日期时间**和**时间戳**在这方面更有效。MySQL 检查内容以确保有效的日期和时间信息，并提供特殊功能来处理这些列。

### 日历弹出窗口

phpMyAdmin 还提供了一个日历弹出窗口，方便数据输入。

首先，我们将在 `book`表中添加**日期**列类型**-发布日期**。如果我们进入**插入**模式，我们现在应该可以看到新的列，在那里我们可以键入日期。还有一个**日历**图标。此图标带来一个弹出窗口，与此**日期**列类型同步。如果列中已有值，则相应地显示弹出窗口。在我们的例子中，列中没有值，因此日历显示当前日期，如以下屏幕截图所示：

![Calendar pop up](graphics/7782_05_32.jpg)

小箭头允许轻松滚动数月和数年。只需点击我们想要的日期，即可将其传送到我们的**发布日期**栏。对于**日期时间**或**时间戳**列类型，弹出窗口提供编辑时间部分的功能。

### 注

如果我们键入一个日期或时间值，如果浏览器启用了 JavaScript，则会进行验证；不正确的值以红色突出显示。

### 时间戳选项

从 MySQL 4.1.2 开始，有更多选项可以影响**时间戳**列类型。让我们在 `book`表中添加一个名为**stamp**的列，类型为**TIMESTAMP**。在**默认**下拉列表中，我们可以选择**当前 _ 时间戳**；但我们不会为这个练习而担心。但是，在**属性**列中，我们选择更新当前时间戳上的**。有关更多详细信息，请访问[http://dev.mysql.com/doc/refman/5.5/en/timestamp.html](http://dev.mysql.com/doc/refman/5.5/en/timestamp.html) 。**

![TIMESTAMP option](graphics/7782_05_33.jpg)

## 位列式

MySQL 5.0.3 引入了真位列。它们在数据库中占用的空间与其定义中的位数相同。假设我们对每本书有以下三条信息，每一条信息只能是真（1）或假（0）：

*   这本书是精装书
*   这本书有一张光盘
*   这本书只有电子版

我们将使用一个**位**列来存储这三条信息。因此，我们在 `book`表中添加了一个长度为**3**（表示 3 位）的列

![Bit column type](graphics/7782_05_34.jpg)

为了构造并随后解释我们存储在该列中的值，我们必须以二进制形式思考，考虑列中每个位的位置。为了表明一本书是精装书，不包含 CD-ROM，并且仅以电子格式提供，我们将使用 `101`值。

phpMyAdmin 以二进制方式处理 `BIT`列。例如，如果我们编辑一行并将 `101`的值设置为**某些 _ 位**列，则在保存时发送以下查询：

```
UPDATE `marc_book`.`book` SET `some_bits` = b '101' 
WHERE `book`.`isbn` = '1-234567-89-0' LIMIT 1;

```

此查询突出显示的部分显示该列确实接收到一个二进制值。在浏览时，精确值（十进制为 `5`——对于我们来说，这是一个无意义的值）以二进制形式 `101`重新显示，这有助于解释每个离散位值。有关位值表示法的更多详细信息，请参见[http://dev.mysql.com/doc/refman/5.5/en/bit-type.html](http://dev.mysql.com/doc/refman/5.5/en/bit-type.html) 。

## 管理指标

正确维护索引对于数据检索速度至关重要。phpMyAdmin 有许多索引管理选项，本节将介绍这些选项。

### 单列索引

我们已经看到了**结构**面板通过**添加主键、添加索引**和**添加唯一索引**等链接，提供了在单个列上创建索引的快速方法。在列列表下，有一个可用于管理索引的界面部分：

![Single-column indexes](graphics/7782_05_35.jpg)

本节提供了编辑或删除每个索引的链接。在这里，**列**部分只列出了每个索引的一列，我们可以看到整个列都参与了索引。这是因为每个列名后面都没有大小信息，这与我们在下一个示例中看到的相反。

现在我们将在标题上添加索引。但是，我们希望限制此索引的长度，以减少磁盘索引结构使用的空间。**在 1 列**上创建索引选项是合适的。所以，我们点击**Go**。在下一个屏幕中，我们指定索引详细信息，如下所示：

![Single-column indexes](graphics/7782_05_36.jpg)

我们在该面板的选项中填写以下信息：

*   **索引名称：**我们发明的一个名称，用于描述该索引的目的
*   **索引类型：**我们可以选择**索引**
*   **列：**我们选择作为索引的列，即**标题**
*   **大小：**我们输入**30**而不是 100（列的完整长度），以节省表中保存索引数据的物理部分的空间

保存此面板后，我们可以从以下屏幕截图确认索引已创建，并且不覆盖**标题**列的整个长度：

![Single-column indexes](graphics/7782_05_37.jpg)

### 多栏索引和索引编辑

在下一个示例中，我们假设在未来的应用程序中，我们需要查找特定作者用特定语言编写的书籍。扩展我们的**作者 id**索引，在其中添加**语言**列是有意义的。

我们点击包含**作者 id**索引行上的**编辑**链接（小铅笔图标）；这将显示此索引的当前状态。接口有空间将另一列添加到此索引。如果需要添加多个列，我们可以使用**添加到索引 1 列**功能。在选择器中，我们选择**语言**。这次我们不必输入大小，因为整个列将用于索引中。为了获得更好的文档，我们更改了**索引名（作者语言**是合适的），如以下屏幕截图所示：

![Multi-column indexes and index editing](graphics/7782_05_38.jpg)

我们保存这个索引修改。在索引列表中，我们可以确认我们的索引修改。

### 全文索引

这种特殊类型的索引允许全文搜索。只有在**VARCHAR**和**TEXT**列类型的 `MyISAM`表上才支持此功能，但 MySQL 5.6 也应该为 `InnoDB`提供此功能。我们可以使用列列表中的**添加全文索引**链接，也可以进入索引管理面板，在下拉菜单中选择**全文索引**。

### 用 EXPLAIN 优化指标

在本节中，我们希望获得一些关于 MySQL 用于特定查询的索引的信息，以及没有定义索引对性能的影响。

假设我们要使用以下查询：

```
SELECT *
FROM `book`
WHERE author_id = 2 AND language = 'es'

```

我们想知道，哪些书是由作者写的，他的 `id`是 `2`，用的是 `es`语言，我们的西班牙语代码。

要进入此查询，我们使用数据库中的**SQL**选项卡或表菜单，或 SQL 查询窗口（参见[第 11 章）](11.html "Chapter 11. Entering SQL Statements")。我们在查询框中输入此查询，然后单击**Go**。查询是否找到任何结果目前并不重要。

### 注

您可以通过以下来自[第 8 章](08.html "Chapter 8. Searching Data")的解释来获得相同的查询，以生成对**作者\ id 2**和语言**es**的搜索。

![Optimizing indexes with EXPLAIN](graphics/7782_05_39.jpg)

现在，我们将使用**【解释 SQL】**链接获取有关此查询使用了哪个索引（如果有）的信息：

![Optimizing indexes with EXPLAIN](graphics/7782_05_40.jpg)

我们可以看到，**EXPLAIN**命令已经传递给 MySQL，告诉我们使用的**键**是**作者语言**。因此，我们知道该索引将用于此类查询。如果这个指数不存在，结果会大不相同。

![Optimizing indexes with EXPLAIN](graphics/7782_05_41.jpg)

这里，**键（NULL）**和**类型（ALL）**表示不使用索引，需要检查所有行以找到所需的数据。根据行的总数，这可能会对性能产生严重影响。通过检查 phpMyAdmin 在每个结果页面**（查询耗时 x 秒）**上显示的查询时间，并将其与索引进行比较，我们可以确定确切的影响。然而，与生产中的实际表相比，如果我们只有有限的测试数据，那么时间上的差异可能是最小的。 `EXPLAIN`输出格式详见[http://dev.mysql.com/doc/refman/5.5/en/explain-output.html](http://dev.mysql.com/doc/refman/5.5/en/explain-output.html) 。

### 检测指标问题

为了帮助用户保持最佳索引策略，phpMyAdmin 尝试检测一些常见的索引问题。例如，让我们访问 `book`表并在**isbn**列上添加索引。当我们显示此表的结构时，会得到一个警告，如以下屏幕截图所示：

![Detecting index problems](graphics/7782_05_42.jpg)

这里的目的是警告我们，在考虑整个表时，索引结构效率低下。我们不需要在同一列上有两个索引。

# 总结

本章研究了数据变化的概念，例如：

*   编辑数据
*   包括 `NULL`列并使用*选项卡*键
*   将函数应用于值
*   复制数据行
*   删除数据、表和数据库

我们还对结构改变技术进行了概述，例如：

*   如何添加列，包括特殊列类型，如文本、BLOB、枚举和集合
*   如何为日期、日期时间和时间戳列类型使用日历弹出窗口
*   如何将二进制数据上载到 BLOB 列中
*   如何管理索引（多列和全文），并从 MySQL 获取关于在特定查询中使用哪些索引的反馈

在下一章中，我们将学习如何出于备份目的导出表的结构和数据，或将其用作另一个应用程序的网关。